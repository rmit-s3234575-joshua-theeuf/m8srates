- if role == :participant
  - content_for :javascript do
    initialize_reply_form('#{I18n.locale}');
  -listing = Listing.find(@listing.id)
  #reply_form.message-avatar-padding.message-reply-form
  -if messages.count == 1 && @current_user.id.to_s.downcase  !=  messages.first[:sender][:id].to_s.downcase && messages.first[:content] =="I accept the loan conditions"
    = form_for message_form, :url => message_form_action do |a|
      = a.label :content, t("conversations.show.write_a_reply")
      = a.text_area :content, :class => "reply_form_text_area", :value=>"On #{Date.today.to_s}, I, #{@current_user.first_name} #{@current_user.last_name} will lend #{messages.first[:sender][:first_name]} #{messages.first[:sender][:last_name]} a sum of $#{(listing[:price_cents]/100)} in the form of (cash, check, travelerâ€™s check, or money order), which is to be repaid in full by #{listing[:duedate]}.
      The interest rate is #{listing[:interest]}% and as a result, the amount due on #{listing[:duedate]} is #{number_with_precision((((listing[:price_cents].to_i)*(1+((listing[:interest].to_i)/100.00)))/100.00).to_d, precision:2)}.", :readonly=> true
      = a.hidden_field :conversation_id
      = a.button t("conversations.show.send_reply"), :onClick=>"history.go(0)"
  -if messages.count == 1 && @current_user.id.to_s.downcase  !=  messages.first[:sender][:id].to_s.downcase && messages.first[:content] !="I cannot accept these loan conditions"
    = form_for message_form, :url => message_form_action do |a|
      = a.label :content, t("conversations.show.write_a_reply")
      = a.text_area :content, :class => "reply_form_text_area", :value=>"Money sent", :readonly=> true
      = a.hidden_field :conversation_id
      = a.button t("conversations.show.send_reply"), :onClick=>"history.go(0)"

%messages
  = render :partial => "conversations/message", :collection => messages, as: :message_or_action
